<f:if condition="{type} === 'demand'">
  <f:then>
      <f:spaceless>
          {"blogpostDemand": [<f:for each="{posts}" iteration="postIterator" as="post">
          <blogvh:cache post="{post}" />
          <f:render section="PostListView" arguments="{post: post,settings:settings,postIterator:postIterator}" />
          {f:if(condition: postIterator.isLast, else: ',')}
        </f:for>],
      </f:spaceless>
  </f:then>
  <f:else>
      <f:spaceless>
          {"relatedPosts": [<f:for each="{posts}" iteration="postIterator" as="post">
          <blogvh:cache post="{post}" />
          <f:render section="PostListView" arguments="{post: post,settings:settings,postIterator:postIterator}" />
          {f:if(condition: postIterator.isLast, else: ',')}
        </f:for>],
      </f:spaceless>
  </f:else>
</f:if>

<f:spaceless>
    "pluginSettings":
      <f:format.raw>
          <f:format.json value="{
          meta : {
            postheader: {
              enable: '{settings.meta.postheader.enable}',
              modifier: '{settings.meta.postheader.modifier}',
              elements:{
                  authorsEnable: '{settings.meta.postheader.elements.authors.enable}',
                  avatarEnable:  '{settings.meta.postheader.elements.avatar.enable}',
                  avatarSize:  '{settings.meta.postheader.elements.avatar.size}',
                  categoriesEnable: '{settings.meta.postheader.elements.categories.enable}',
                  tagsEnable: '{settings.meta.postheader.elements.tags.enable}',
                  publishedEnable: '{settings.meta.postheader.elements.published.enable}',
                  publishedFormat: '{settings.meta.postheader.elements.published.format}',
                  commentsEnable: '{settings.meta.postheader.elements.comments.enable}',
                },
              },
            postfooter: {
              enable: '{settings.meta.postfooter.enable}',
              modifier: '{settings.meta.postfooter.modifier}',
              elements:{
                  authorsEnable: '{settings.meta.postfooter.elements.authors.enable}',
                  avatarEnable:  '{settings.meta.postfooter.elements.avatar.enable}',
                  avatarSize:  '{settings.meta.postfooter.elements.avatar.size}',
                  categoriesEnable: '{settings.meta.postfooter.elements.categories.enable}',
                  tagsEnable: '{settings.meta.postfooter.elements.tags.enable}',
                  publishedEnable: '{settings.meta.postfooter.elements.published.enable}',
                  publishedFormat: '{settings.meta.postfooter.elements.published.format}',
                  commentsEnable: '{settings.meta.postfooter.elements.comments.enable}',
                },
              },
            listheader: {
              enable: '{settings.meta.listheader.enable}',
              modifier: '{settings.meta.listheader.modifier}',
              elements:{
                  authorsEnable: '{settings.meta.listheader.elements.authors.enable}',
                  avatarEnable:  '{settings.meta.listheader.elements.avatar.enable}',
                  avatarSize:  '{settings.meta.listheader.elements.avatar.size}',
                  categoriesEnable: '{settings.meta.listheader.elements.categories.enable}',
                  tagsEnable: '{settings.meta.listheader.elements.tags.enable}',
                  publishedEnable: '{settings.meta.listheader.elements.published.enable}',
                  publishedFormat: '{settings.meta.listheader.elements.published.format}',
                  commentsEnable: '{settings.meta.listheader.elements.comments.enable}',
                },
              },
            listfooter: {
              enable: '{settings.meta.listfooter.enable}',
              modifier: '{settings.meta.listfooter.modifier}',
              elements:{
                  authorsEnable: '{settings.meta.listfooter.elements.authors.enable}',
                  avatarEnable:  '{settings.meta.listfooter.elements.avatar.enable}',
                  avatarSize:  '{settings.meta.listfooter.elements.avatar.size}',
                  categoriesEnable: '{settings.meta.listfooter.elements.categories.enable}',
                  tagsEnable: '{settings.meta.listfooter.elements.tags.enable}',
                  publishedEnable: '{settings.meta.listfooter.elements.published.enable}',
                  publishedFormat: '{settings.meta.listfooter.elements.published.format}',
                  commentsEnable: '{settings.meta.listfooter.elements.comments.enable}',
                },
            },
            teaserheader: {
              enable: '{settings.meta.teaserheader.enable}',
              modifier: '{settings.meta.teaserheader.modifier}',
              elements:{
                  authorsEnable: '{settings.meta.teaserheader.elements.authors.enable}',
                  avatarEnable:  '{settings.meta.teaserheader.elements.avatar.enable}',
                  avatarSize:  '{settings.meta.teaserheader.elements.avatar.size}',
                  categoriesEnable: '{settings.meta.teaserheader.elements.categories.enable}',
                  tagsEnable: '{settings.meta.teaserheader.elements.tags.enable}',
                  publishedEnable: '{settings.meta.teaserheader.elements.published.enable}',
                  publishedFormat: '{settings.meta.teaserheader.elements.published.format}',
                  commentsEnable: '{settings.meta.teaserheader.elements.comments.enable}',
                },
              },
            teaserfooter: {
              enable: '{settings.meta.teaserfooter.enable}',
              modifier: '{settings.meta.teaserfooter.modifier}',
              elements:{
                  authorsEnable: '{settings.meta.teaserfooter.elements.authors.enable}',
                  avatarEnable:  '{settings.meta.teaserfooter.elements.avatar.enable}',
                  avatarSize:  '{settings.meta.teaserfooter.elements.avatar.size}',
                  categoriesEnable: '{settings.meta.teaserfooter.elements.categories.enable}',
                  tagsEnable: '{settings.meta.teaserfooter.elements.tags.enable}',
                  publishedEnable: '{settings.meta.teaserfooter.elements.published.enable}',
                  publishedFormat: '{settings.meta.teaserfooter.elements.published.format}',
                  commentsEnable: '{settings.meta.teaserfooter.elements.comments.enable}',
                },
              },
            default: {
              enable: '{settings.meta.default.enable}',
              modifier: '{settings.meta.default.modifier}',
              elements:{
                  authorsEnable: '{settings.meta.default.elements.authors.enable}',
                  avatarEnable:  '{settings.meta.default.elements.avatar.enable}',
                  avatarSize:  '{settings.meta.default.elements.avatar.size}',
                  categoriesEnable: '{settings.meta.default.elements.categories.enable}',
                  tagsEnable: '{settings.meta.default.elements.tags.enable}',
                  publishedEnable: '{settings.meta.default.elements.published.enable}',
                  publishedFormat: '{settings.meta.default.elements.published.format}',
                  commentsEnable: '{settings.meta.default.elements.comments.enable}',
                },
              },
          },
          featureImgWidth: '{settings.teaser.featuredImage.width}',
          featureImgHeight: '{settings.teaser.featuredImage.height}',
          action: 'listByDemand Or relatedPosts',
      }"/>}
      </f:format.raw>
</f:spaceless>
<f:section name="PostListView">
    <f:spaceless>
        <f:format.raw>
            <f:format.json value="{
                    uid: post.uid,
                    doktype: post.doktype,
                    detail: '{f:uri.page(pageUid: post.uid)}',
                    title: post.title,
                    abstract: post.abstract,
                    description: post.description,
                    commentsActive: post.commentsActive,
                    archiveDate: post.archiveDate,
                    publishDate: '{f:if(condition: post.publishDate, then: \'{post.publishDate -> f:format.date(format: settings.dateFormat)}\')}',
                    commentsActive: post.commentsActive,
                    crdate: '{f:if(condition: post.crdate, then: \'{post.crdate -> f:format.date(format: settings.dateFormat)}\')}',
                    media: '{f:render(partial: \'Files\', arguments: \'{files: post.media, view: \\\'list\\\', type: \\\'media\\\'}\') -> headless:format.json.decode()}',
                    featuredImage: '{f:render(partial: \'Files\', arguments: \'{feature: post.featuredImage, view: \\\'list\\\', type: \\\'media\\\'}\') -> headless:format.json.decode()}',
                    authors: '{f:render(section: \'Authors\', arguments: \'{authors: post.authors, settings: settings}\') -> headless:format.json.decode()}',
                    comments: '{f:render(section: \'Comments\', arguments: \'{comments: post.comments, settings: settings}\') -> headless:format.json.decode()}',
                    tags: '{f:render(section: \'Tags\', arguments: \'{tags: post.tags, settings: settings}\') -> headless:format.json.decode()}',
                  }"/>
        </f:format.raw>
    </f:spaceless>
</f:section>

<f:section name="Comments">
    <f:spaceless>
        {"listComments": [<f:for each="{comments}" iteration="commentIterator" as="comment">
        <f:format.raw>
            <f:format.json value="{
                  uid: comment.uid,
                  pid: comment.pid,
                  name: '{f:if(condition: comment.name, then: comment.name)}',
                  email: '{f:if(condition: comment.email, then: comment.email)}',
                  url: '{f:if(condition: comment.url, then: comment.url)}',
                  comment: '{f:if(condition: comment.comment, then: \'{comment.comment -> blogvh:format.nl2p()}\')}',
                  crdate: '{f:if(condition: comment.crdate, then: \'{comment.crdate -> f:format.date(format: settings.comments.date.format)}\')}',
                  hp: comment.hp,
                  postLanguageId: comment.postLanguageId,
                  hidden: comment.hidden,
        }"/>
        </f:format.raw>
        {f:if(condition: commentIterator.isLast, else: ',')}
    </f:for>]}
    </f:spaceless>
</f:section>

<f:section name="Authors">
    <f:spaceless>
        {"listAuthors": [<f:for each="{authors}" iteration="authorIterator" as="author">
        <f:format.raw>
            <f:format.json value="{
                uid: author.uid,
                name: '{f:if(condition: author.name, then: author.name)}',
                slug: '{f:if(condition: author.slug, then: author.slug)}',
                title: '{f:if(condition: author.title, then: author.title)}',
                website: '{f:if(condition: author.website, then: author.website)}',
                profile: '{f:if(condition: author.profile, then: author.profile)}',
                bio: '{f:if(condition: author.bio, then: author.bio)}',
                detailsPage: '{f:if(condition: author.detailsPage, then: author.detailsPage)}',
            }"/>
        </f:format.raw>
        {f:if(condition: authorIterator.isLast, else: ',')}
    </f:for>],
        "settings":
        <f:format.raw>
            <f:format.json value="{
                          avatarSize: settings.authors.avatar.provider.size,
                          authorUid: settings.authorUid
                      }"/>}
        </f:format.raw>
    </f:spaceless>
</f:section>

<f:section name="Tags">
    <f:spaceless>
        {"listTags": [<f:for each="{tags}" iteration="tagIterator" as="tag">
        <f:format.raw>
            <f:format.json value="{
                        uid: tag.uid,
                        title: tag.title,
                        tagLink: '{blogvh:link.tag(tag: tag, rss: true)}',
                        description: '{f:if(condition: tag.description, then: tag.description)}',
                        tagUid: '{f:if(condition: settings.tagUid, then: settings.tagUid)}',
                        linkPage: '{f:link.page(pageUid: settings.tagUid)}',
                        contentElementUidList: '{tag.contentElementUidList -> f:cObject(typoscriptObjectPath: \'lib.blog.contentElementRendering\')}'
                }"/>
        </f:format.raw>
        {f:if(condition: tagIterator.isLast, else: ',')}
    </f:for>]}
    </f:spaceless>
</f:section>

